## Appendix
Socket: Unique combination of ip+port

![overhead](https://www.homenethowto.com/wp-content/uploads/overhead-1.jpg)  
What are the OSI levels? - APSTNDP  
1. Layer 1, Physical Layer - physical connection between devices, include cable, pinouts, voltages, network interface card  
2. Layer 2, Data link Layer - in charge of trasmitting to  the correct hose using MAC Address. Package bits/data from network layer into units called frames, tying cable card to wireless card. When it gets the packet, it will place an ARP request asking "who has the IP address?"
  - error control: detects and retransmits damaged or lost frames.
  - flow control: coordinates that amount of data that can be sent before receiving acknowledgement.
  - has source mac and destination mac
  **Packet in Data Link layer is referred as Frame.**
3. Layer 3, Network Layer/IP Layer - IP address, transfer logical address to physical, performs network routing(router)
  - Routing: determine which route is suitable from source to destination. 
  - Logical Addressing: The sender & receiver’s IP address are placed in the header by network layer
  - Fragmentation(MTU): Splitting of data packets that are too large to be transmitted on the network
  - has source IP and destination IP
  **Segment in Network layer is referred as Packet.**
4. Layer 4 Transport Layer - Manage and Control layer, Transfer of data TCP/UDP, split communication into packages
  - error control: detects and retransmits damaged or lost frames.
  - flow control: coordinates that amount of data that can be sent before receiving acknowledgement.
  - Segmentation: process of dividing a data packet into smaller units for transmission over the network
  - adds Source and Destination port number in its header
  Transport layer is operated by the Operating System
5. Layer 5 session layer - traffic control(establish, manage, terminate connections), coordinate communication
  - establishment of connection, maintenance of sessions, authentication and also ensures security.
  - Synchronization 
6. Layer 6 Presesntation layer - format data, encryption/decryption
  - data from the application layer is extracted here and manipulated as per the required format to transmit over the network.
  - Compression
7. Layer 7 Application layer - network access, enables apps to access the net, SMTP, HTTP, FTP
  - Application – Browsers, Skype Messenger etc.


## Layer 1, Physical Layer
### Transmission mode
1. Simple Mode - communication is unidirectional
2. Half Duplex Mode - Only one can be talking at the same time (walkie talkie)
3. Full Duplex Mode - Two of them can talk at the same time, normal telephone

### Redundant Link problems in Computer Network
1. Broadcast Storm, a switch forwards out the broadcast frame, generated by another device, to all its ports. And the other device forward it again causing a snowball  
2. Multiple copies, CPU send to switch A, switch A send to router+switch B. Switch B sends to router.
3. MAC Table Trashing, the switch receives the frame of same source from more than one link

### What is MAC address used for?
Without a MAC address computers would not be able to identify themselves on a network before they gets an IP assigned

### Equipment
Hub: receive data and send it out to everyone, relies on computer to reject  
Switch: Smart hub, Track port usage using MAC  
Repeater: making signal stronger/clean up signal  
Router: move data across different networks, manage traffic flow, has public/private IP, DHCP server, built in firewalls


## Layer 2, Data link Layer
### P2P File Sharing
The peers request for the files from other peers by establishing TCP or UDP connections.
1. Centralized Directory - one server acts as index to provide the destination when other requests
2. Query Flooding - the computer pings it's neighbour nodes
3. Exploiting Heterogeneity - combination of 1+2 with the one with the better network being a superhost

### Framing in data link layer
At data link layer, it extracts message from sender and provide it to receiver by providing sender’s and receiver’s address. The advantage of using frames is that data is broken up into recoverable chunks that can easily be checked for corruption.
1. Fixed size framing - frame is of fixed size, will do padding if insufficient, frame acts as delimiter
2. Variable size - use end delimiter or length field
![Extended Ethernet Frame](https://i.imgur.com/AgRi9P4.png)

### Reliable transfers
1. Stop and Wait  
The sender sends the packet and waits for the ACK (acknowledgement) of the packet. Once the ACK reaches the sender, it transmits the next packet in row. If the ACK is not received, it re-transmits the previous packet again.
2. Go Back N  
The sender sends N packets which is equal to the window size. Once the entire window is sent, the sender then waits for a cumulative ACK to send more packets. On the receiver end, it receives only in-order packets and discards out-of-order packets. As in case of packet loss, the entire window would be re-transmitted.
3. Selective Repeat  
The sender sends packet of window size N and the receiver acknowledges all packet whether they were received in order or not. In this case, the receiver maintains a buffer to contain out-of-order packets and sorts them.The sender selectively re-transmits the lost packet and moves the window forward.


### What is TCP/IP
A suite of protocols for the internet, in order to communnicate, a shared language has to be used

## Layer 3, Network Layer
### Unicast/Multicast/Broadcast
Unicast: 1-1  
Multicast: 1-Many  
Broadcast: such as DHCP Servers, it uses 255.255.255.255  

### Classful addressing (IPv4)
IPv4 address is divided into two parts:  
Network ID  
Host ID  
![classful addresing](https://i.imgur.com/E06iS0R.png)  
![Summary of classful addressing](https://i.imgur.com/b7A3HVu.png)  
Summary of classful addressing  

### Fragmentation with MTU
Example: For a data packet of 4000 bytes and MTU of 1500 bytes, we have actual data of 3980 bytes that is to be transmitted and 1480 bytes is the maximum data size that is permissible to be sent. So, there would be 3 fragments:  
For the first fragment, data size = 1480 bytes, offset = 0 and MF flag = 1  
For the second fragment, data size = 1480 bytes, offset = 1480 and MF flag = 1  
For the third fragment, data size = 1020 bytes, offset = 2960 and MF flag = 0  

An important point to be noted here is that all fragments would be having same identification number, thus indicating that all the fragments belong to the same parent data packet.

### Subnetting / Subnet Mask
Example : Given IP address 132.6.17.85 and default class B mask, find the beginning address (network address).  

Solution : The default mask is 255.255.0.0, which means that the only the first 2 bytes are preserved and the other 2 bytes are set to 0. Therefore, the network address is 132.6.0.0.  

### IPv4 Classless Subnet equation
![classless subnet equation](https://i.imgur.com/MOcWPJs.png)
![classless subnet question](https://i.imgur.com/cQJRU9e.png)

### Classification of Routing Algorithms
Routing is process of establishing the routes that data packets must follow to reach the destination
1. Adaptive Algorithms - algorithms which change their routing decisions whenever network topology or traffic load changes
  - Neighbor table： contains information about the neighbors of the router only, i.
  - topology table： contains both best and backup routes to particular advertised network.
  - routing table： This table contains all the best routes to the advertised network.
2. Non-Adaptive Algorithms - flooding

### Internet Control Message Protocol (ICMP)
Since IP does not have a inbuilt mechanism for sending error and control messages. It depends on Internet Control Message Protocol(ICMP) to provide an error control.  
![icmp](https://i.imgur.com/Ikk783T.png)  
ICMP will take source IP from the discarded packet and informs to source by sending source quench message.  
Then source will reduce the speed of transmission so that router will free for congestion.  
![far-icmp](https://i.imgur.com/biIMoz8.png)  
When the congestion router is far away from the source the ICMP will send hop by hop source quench message so that every router will reduce the speed of transmission.

Other problems sent by ICMP including: Time exceeded message, Destination un-reachable

## Layer 4, Transport Layer

### Congestion Control
A state occuring in the network layer when the message traffic is so heavy it slows down network response time.
1. As delay increases, performance decreases.
2. If delay increases, retransmission occurs, making situation worse.

Congestion Control Algorithms include:
**Leaky Bucket Algorithm** - no matter the burst of input, the output flows at a constant rate, implemented using FIFO queue
  1. When host wants to send packet, packet is thrown into the bucket.
  2. The bucket leaks at a constant rate, meaning the network interface transmits packets at a constant rate.
  3. Bursty traffic is converted to a uniform traffic by the leaky bucket.
  4. In practice the bucket is a finite queue that outputs at a finite rate.  
![leaky bucket](https://i.imgur.com/uGuKpdw.png)  

Algorithm: The following is an algorithm for variable-length packets:  
  1. Initialize a counter to n at the tick of the clock.
  2. If n is greater than the size of the packet, send the packet and decrement the counter by the packet size. Repeat this step until n is smaller than the packet size.
  3. Reset the counter and go to step 1.  
![leaky algo](https://i.imgur.com/RffFfo2.png)

**Token bucket Algorithm** - a token is generated/regenerated at a certain rate, each transmission requires one token
  1. In regular intervals tokens are thrown into the bucket. ƒ
  2. The bucket has a maximum capacity. ƒ
  3. If there is a ready packet, a token is removed from the bucket, and the packet is sent.
  4. If there is no token in the bucket, the packet cannot be sent.  
![token bucket](https://i.imgur.com/XGqwRyG.png)


### Transmission Control Protocol(TCP)
Includes protocols such as SSH, POP3, HTTP. It's a one to one communication. Used such as when transferring file.
  - Reliable (Positive Acknowledgement with Re-transmission(PAR), it will resends until it gets a ACK)
  - Stream oriented
  - Multiplexing
  - full duplex
![TCP Segment Structure](https://media.geeksforgeeks.org/wp-content/uploads/TCPSegmentHeader-1.png)
Sequence Number - number of the starting packet to transmit
Acknowledge number - the byte number that the receiver expects to receive next

### TCP Congestion Control
1. Slow Start Phase: starts slowly increment is exponential to threshold, window = 2^(1) -> 2^(2) -> 2^(3)
2. Congestion Avoidance Phase: After reaching the threshold increment is by 1, window = window + 1 -> window + 2 -> window + 3
3. Congestion Detection Phase: Sender goes back to Slow start phase or Congestion avoidance phase.
  - If retransmission occurs, it means congestion occurs. Retransmission occurs if RTO timer times out or when three ACK is received.
    Case 1: Retransmission due to Timeout – In this case congestion possibility is high.
    - ssthresh is reduced to half of the current window size.
    - set cwnd = 1
    - start with slow start phase again.

    Case 2 : Retransmission due to 3 Acknowledgement Duplicates – In this case congestion possibility is less.
    (a) ssthresh value reduces to half of the current window size.
    (b) set cwnd= ssthresh
    (c) start with congestion avoidance phase

**Example** – 
1. Assume a TCP protocol experiencing the behavior of slow start. 
2. At 5th transmission round with a threshold (ssthresh) value of 32 goes into congestion avoidance phase and continues till 10th transmission. 
3. At 10th transmission round, 3 duplicate ACKs are received by the receiver and enter into additive increase mode. 
4. Timeout occurs at 16th transmission round. Plot the transmission round (time) vs congestion window size of TCP segments.
![](https://media.geeksforgeeks.org/wp-content/uploads/20171028_002328.jpg)

### Error control in TCP
Error control in TCP is mainly done through use of three simple techniques
1. Checksum - it has a checksum field, if checksum mismatch, receiver will discard the segment
2. Acknowledgement - it will acknowledge the segment if it is received and correct
3. Retransmission  - when a segment is missing, delayed or corrupted, then retransmit will happen. Segments will retransmit in 2 scenarios:
  - Retransmission after RTO(retransmission time-out): RTO value is dynamic in nature and it is updated using round trip time (RTT)
  - Retransmission after Three duplicate ACK segments: RTO value works well only when RTT is small. Sometimes when RTT is too large, and a segment is lost causing out-of-order segments that they cannot be saved. In order to solve this, three duplicate ACK is used and fast retransmit will occur by only sending the missing segments.
  
### TCP Packets
When we send data, we push data as a stream, 20 Bytes header and 80 Bytes dynamic body. Data is being break down into packages. Header is needed such that the other will know when a package is missing. All packages are equal size and can be broken anyone

### TCP Connection Established
Three way handshake is involved
![3 way handshake connection](https://www.mdpi.com/applsci/applsci-06-00358/article_deploy/html/images/applsci-06-00358-g001.png)
Alice -SYN-> Bob    SYNchronize with my Initial Sequence Number of X
Alice <-ACK- Bob    I received your syn, I ACKnowledge that I am ready for [X+1]
Alice <-SYN- Bob    SYNchronize with my Initial Sequence Number of Y
Alice -ACK-> Bob    I received your syn, I ACKnowledge that I am ready for [Y+1]

### TCP Connection Termination
![3way termination](https://media.geeksforgeeks.org/wp-content/uploads/CN.png)
1. Client sends a TCP segment with FIN bit set to 1 and enter the **FIN_WAIT_1** state
2. server received the TCP segment with FIN bit and immediately sends an ACK back.
3. Client receives the ACK and enters **FIN_WAIT_2** state and wait for the next FIN TCP Segment.
4. Server sends FIN Segment.
5. Client receives the FIN segment and enters **TIME_WAIT** state. Then transmit the ACK to the server. The TIME_WAIT state lets the client resend the final acknowledgment in case the ACK is lost. After the wait, the connection formally closes and all resources on the client side (including port numbers and buffer data) are released.
Alice -FIN-> Bob    
Alice <-ACK- Bob    
Alice <-FIN- Bob    
Alice -ACK-> Bob    

### SSL Handshake
SSL does not mandate that Alice and Bob use a specific symmetric key algorithm, a specific public-key algorithm, or a specific MAC. Instead, SSL allows Alice and Bob to agree on the cryptographic algorithms at the beginning of the SSL session, during the handshake phase. Additionally, during the handshake phase, Alice and Bob send nonces to each other, which are used in the creation of the B session keys (E , M , E , and M ). The steps of the real SSL handshake are as follows:
1. The client sends a list of cryptographic algorithms it supports, along with a client nonce.
2. From the list, the server chooses a symmetric algorithm (for example, AES), a public key algorithm (for example, RSA with a specific key length), and a MAC algorithm. It sends back to the client its choices, as well as a **certificate** and a server **nonce**.
3. The client verifies the certificate, extracts the server’s public key, generates a Pre-Master Secret (PMS), encrypts the PMS with the server’s public key, and sends the encrypted PMS to the server.

### Extras
1. The Retransmit timeout interval doubles everytime it retransmit.
2. If packet 1 ACK got lost but packet 2 ACK arrives, Client knows that server receives up to all of them.
3. Fast Retransmit happens if the sender receives three duplicate ACKS(receiver will send the last number of ACK it successfully received for out-of-order package/discarded package)
4. For Digital Signature, one can encrypt the message with his private key. The other party can decrypt with public key to verify the authenticity.
5. A secret known to only both party is added and hashed together.![mac authentication](https://i.imgur.com/usb64H6.png)

### TCP Timers
1. Retransmission Timer - To retransmit lost segments
2. Persistent Timer - When the sending TCP receives an acknowledgment with a window size of zero, it starts a persistence timer. It will fire a probe at the end. The probe causes the receiving TCP to resend the acknowledgment which was lost.
3. Keep Alive Timer - A keepalive timer is used to prevent a long idle connection between two TCPs. The timer is received everytime a new segment is received from the client. If no response after, probing starts. Force terminate after 10 proves, 75sec each
4. Time Wait Timer - used during termination. After a connection close, there may be still be datagrams coming through. The quiet timer is intended to prevent the just-closed port from reopening again quickly and receiving these last datagrams.  

### TCP Flags
SYN: Synchronization  
ACK: Acknowledgement  
FIN: Finish  
RST: Reset, abruptly tells the other that you want to stop communication and discard all data  
PSH: Sends the packet to the network layer as soon as you received it instead of buffering it(集运)  
URG: priority queue  

### User Datagram Protocols(UDP)
![udp](https://media.geeksforgeeks.org/wp-content/uploads/UDP-header.png)  
Source Port : Source Port is 2 Byte long field used to identify port number of source.  
Destination Port : It is 2 Byte long field, used to identify the port of destined packet.  
Length : Length is the length of UDP including header and the data. It is 16-bits field.  
Checksum : Checksum is 2 Bytes long field.  

Does not verify connection, no three-way handhsake, not limited to 1-1. When we still can make sense of the data. 8 bytes header and all body has different sizes. Used such as streaming video, when you want to keep it as fast as possible without caring about the quality

### Ports
ports allow us to have multiple apps using the network connection, communicate over TCP/UDP  
FTP:21 TCP - File Transfer Protocol, insecure not encrypted  
SFTP:22 TCP - secure version of FTP, encrypted with SSH  
SMTP:25 TCP - simple mail transfer protocol  
POP3:110 TCP - post office protocol 3, client download from server  
HTTP:80 TCP - Hyper Text Transfer Protocol, web browsers, all content is in clear text  
HTTPS:443 TCP - secure version of HTTP, content is encrypted, certificate between user and server is signed  

### Internet Protocol(IP)
Is used when it's outside of our network.  
![protocol overview](https://i.imgur.com/9sKyML4.png)  
Protocols:  
ARP(Layer 2): Address Resolution Protocol - Map IP to MAC Addresses  
TCP/UDP(Layer 4): Controls protocol  
DNS(Layer 5): resolve domain name into IP address  
DHCP(Layer 3): Server protocols that hands out IP  

## Layer 7, Application Layer
### Domain Name Service(DNS)
It resolved fully qualified domain name to IP, easier for humans to remember names. Not able for a server to know all IP, so we will ask all servers around until we get the one we want.
1. A computer will look in it's cache file, then host file for a request.
2. If neither is found, it will send a DNS request to the router, the router will then query the Local DNS Server.
3. If neither is found, the local DNS server will query the external DNS server.
  - as example www.apple.com
  - resolver will send to root server and cache the response of TLD domain for root server (<a>.root-servers.net) to find .com TLD(Top Level Domain) server
  - root server will pass them to .com TLD server
  - .com TLD server will pass them to authorative nameserver ns1.apple.com
4. External DNS will return with the correct IP and location.
5. Local DNS will cache it and return back to client.
6. Client will then make a request directly though router with the information.

## Wireless Encryption
Encryption Protocol
1. WEP(Wired Equivalent Privacy) - Easily broken, original protocol
2. WPA(Wifi Protected Access) - Temporary enhancement
3. WPA2(Wifi Protected Access 2) - Advanced Encryption Standard

Device Placement
1. Put at a secure location

## Virtual Private Network(VPN)
Tunnel/Encrypt connection by creating a private network on a public network. HTTPS provides end-to-end encryption, while a VPN provides encryption from your device to the VPN server. A VPN secures all online communications coming from your device, while HTTPS only provides encryption between the website and your browser.
1. Client To Site(VPN) - tunneling to the server directly
2. Site to Site - connect two networks, such as multiple office

### VPN Web Protocols
Several ways VPN can be established
1. SSL(Secure Socket Layer)
  - web based VPN(HTTPS)
  - Uses Certificate for mutual Auth
  - Replaced by TLS
2. TLS(Transport Layer Security)
  - more common for https
  - certificates
3. TLS 1.2
  - enhanced security
  - tighter security, hash
  
### L2TP (Layer 2 Tunneling Protocol)
Carries layer 2 traffic over layer 3, no encryption by itself but utilizes IPSec as encryption and authentication measure

IPSec encrypts data at Layer 3
  - ESP(Encapsulating Security Payload) - Encrypt connection with Sym Algorithms
  - AH(Authentication Header) - Creates checksum & hashes packets. A header that is added to data package, has a checksum to make sure data is not tampered with
  - IPComp(IP Payload Compression) - Compress IP Payload
  - IKE(Internet Key Exchange) - negotiates shared secret
![tunneling](https://i.imgur.com/Opucm6L.png)

## Single Sign-On
One sign on allow you to access multiple sites, downside is you have to trust the server. Upside is you only need to enter you password once

## Encryption
Symmetric encryption - encryption and decryption uses the same key for all users, it's hard to track down when something is compromised
Asymmetric keys, encryption and decryption uses different keys, a public key and a private key
One way hash, we cannot track it back to original value

## PKI
1. CA(Certificate Authority) is in charge of generating the private/public key.
2. CA issue private key to Company 1(signed by CA).
3. Company 1 encrypt data and send to company 2
4. Company 2 received the data and look at the signature to identify the CA
5. They ask CA for Company 1's public key to decrypt

## Port mirroring
Take a copy of the items and forward it to another physical port, commonly used with IDS(Intrusion detection system). Intrusion Prevention Systems also analyzes packets, but can also stop the packet from being delivered based on what kind of attacks it detects — helping stop the attack.
![ids](https://i.imgur.com/7yo9gL5.png)

## Wifi 2.4GHz vs 5Ghz
5Ghz can transfer mroe data, but it gets interfere easily. 2.4Ghz is longer range but only one cycle gets affected as compared to 5GHz's 2 cycle.
![interference](https://i.imgur.com/NehamAi.png)

## Load Balancing
To distribute load between different servers  
Algorithms:
1. Round robin - distribute equaly for each server
2. Least Time Response - LB will send out ping to each server, first server to reply will be served the request
3. weighted round robin - each server is given a different weigh of messages
3. Consistent Hash - imagine on a circle, the request will be mapped to a point. going clockwise, the first server that it hits will serve the request.
3. Consistent Hash - imagine on a circle, the request will be mapped to a point. going clockwise, the first server that it hits will serve the request.

{read textbook chapter 3, 8.3-8.6
